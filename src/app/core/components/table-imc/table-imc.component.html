<div class="col-12">
	<div class="card">
		<p-confirmDialog header="Confirmar" key="confirm1" icon="pi pi-exclamation-triangle" message="Estas seguro?"
			[style]="{width: '350px'}" acceptButtonStyleClass="p-button-text"
			rejectButtonStyleClass="p-button-text"></p-confirmDialog>

		<!-- formulario ingresar cliente, por default viene oculto -->
		<section>
			<p-dialog [(visible)]="createClientDialog" [style]="{width: '80%'}" [header]="dialogHeader" [modal]="true"
				class="p-fluid">
				<ng-template pTemplate="content">
					<div class="formgrid grid">
						<div class="field col-12 md:col-6 lg:col-4">
							<label for="name">Nombre</label>
							<input type="text" pInputText id="name" [(ngModel)]="client.name" required autofocus
								[ngClass]="{'ng-invalid ng-dirty' : submitted && !client.name}" autocomplete="off" />
							<small class="p-error" *ngIf="submitted && !client.name">El nombre es requerido.</small>
						</div>
						<div class="field col-12 md:col-6 lg:col-4">
							<label for="email">Email</label>
							<input type="email" pInputText id="email" [(ngModel)]="client.email" required autofocus
								[ngClass]="{'ng-invalid ng-dirty' : submitted && !client.email}" autocomplete="off" />
							<small class="p-error" *ngIf="submitted && formErrors()['email']">{{ formErrors()['email']
								}}</small>
						</div>
						<div class="field col-12 md:col-6 lg:col-4">
							<label class="mb-3">Sexo</label>
							<div class="formgrid grid">
								<div class="field-radiobutton col-4">
									<p-radioButton id="hombre" name="sexo" value="M"
										[(ngModel)]="client.sexo"></p-radioButton>
									<label for="hombre">Hombre</label>
								</div>
								<div class="field-radiobutton col-4">
									<p-radioButton id="mujer" name="sexo" value="F"
										[(ngModel)]="client.sexo"></p-radioButton>
									<label for="mujer">Mujer</label>
								</div>
							</div>
							<small class="p-error" *ngIf="submitted && formErrors()['sexo']">{{ formErrors()['sexo']
								}}</small>
						</div>
					</div>

					<div class="formgrid grid">
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="age">Fecha de nacimiento NEW</label>
							<!-- Usar ngModelChange o onSelect para detectar la selección correctamente -->
							<p-calendar id="born" [(ngModel)]="client.born" [showIcon]="true" inputId="icon"
								(ngModelChange)="calcularEdad($event)" (onSelect)="calcularEdad($event)"
								dateFormat="yy-mm-dd"></p-calendar>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="age">Edad</label>
							<p-inputNumber id="age" [(ngModel)]="client.age" [minFractionDigits]="0"
								[maxFractionDigits]="0" mode="decimal" readonly></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="peso">Peso (Kg)</label>
							<p-inputNumber id="peso" [(ngModel)]="client.peso" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="estatura">Estatura (Metros)</label>
							<p-inputNumber id="estatura" [(ngModel)]="client.estatura" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
					</div>
					<div class="formgrid grid">

						<div class="field col-12 md:col-6 lg:col-3">
							<label for="circunferencia">circunferencia de cintura </label>
							<p-inputNumber id="circunferencia" [(ngModel)]="client.circunferencia"
								[minFractionDigits]="2" [maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="muneca">Muñeca</label>
							<p-inputNumber id="muneca" [(ngModel)]="client.muneca" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="brazo">Brazo</label>
							<p-inputNumber id="brazo" [(ngModel)]="client.brazo" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-3">
							<label for="abdominal">Abdominal</label>
							<p-inputNumber id="abdominal" [(ngModel)]="client.abdominal" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>

					</div>
					<div class="formgrid grid">
						<div class="field col-12 md:col-6 lg:col-4">
							<label for="cadera">Cadera</label>
							<p-inputNumber id="cadera" [(ngModel)]="client.cadera" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-4">
							<label for="triceps">Triceps</label>
							<p-inputNumber id="triceps" [(ngModel)]="client.triceps" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
						<div class="field col-12 md:col-6 lg:col-4">
							<label for="subescapular">Subescapular</label>
							<p-inputNumber id="subescapular" [(ngModel)]="client.subescapular" [minFractionDigits]="2"
								[maxFractionDigits]="2" mode="decimal"></p-inputNumber>
						</div>
					</div>
					<div class="field">
						<label for="address">Dirección corta</label>
						<input type="address" pInputText id="address" [(ngModel)]="client.address" required autofocus
							autocomplete="off" />
					</div>
					<div class="field">
						<label class="mb-3">Estatus</label>
						<div class="flex flex-wrap gap-3">
							<div class="field-radiobutton">
								<p-radioButton id="consulta" name="status" value="Consulta"
									[(ngModel)]="client.status"></p-radioButton>
								<label for="consulta">Consulta</label>
							</div>
							<div class="field-radiobutton">
								<p-radioButton id="fijo" name="status" value="Fijo"
									[(ngModel)]="client.status"></p-radioButton>
								<label for="fijo">Fijo</label>
							</div>
							<div class="field-radiobutton">
								<p-radioButton id="gym" name="status" value="Gym"
									[(ngModel)]="client.status"></p-radioButton>
								<label for="gym">Gym</label>
							</div>
							<div class="field-radiobutton">
								<p-radioButton id="redes" name="status" value="Redes"
									[(ngModel)]="client.status"></p-radioButton>
								<label for="redes">Redes</label>
							</div>
							<div class="field-radiobutton">
								<p-radioButton id="recomendado" name="status" value="Recomendado"
									[(ngModel)]="client.status"></p-radioButton>
								<label for="recomendado">Recomendado</label>
							</div>
						</div>
					</div>
				</ng-template>

				<ng-template pTemplate="footer">
					<section>
						@if (indicAgregarOrUpdate === false) {
						<button pButton pRipple label="Mas datos" icon="pi pi-address-book" class="p-button-text"
							(click)="editarDataosPaciente()"></button>
						}
						<button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
							(click)="hideDialog()"></button>
						@if (indicAgregarOrUpdate === true) {
						<button pButton pRipple label="Crear" icon="pi pi-check" class="p-button-text"
							(click)="saveClient()"></button>
						} @else {
						<button pButton pRipple label="Actualizar" icon="pi pi-check" class="p-button-text"
							(click)="saveClient()"></button>
						}
					</section>
				</ng-template>


			</p-dialog>
		</section>

		<!-- Table Clientes -->
		@if (this.clients().length > 0) {

		<section>
			<h5>Datos paciente</h5>
			<div class="flex gap-3">
				<span class="p-buttonset">
					<button pButton pRipple label="Nuevo" icon="pi pi-plus" class="mr-2" (click)="openNew(0)"></button>
				</span>
				<span class="block mt-2 md:mt-0 p-input-icon-left">
					<i class="pi pi-search"></i>
					<input pInputText type="text" placeholder="Buscar..." (input)="onGlobalFilter(dt, $event)"
						class="w-full sm:w-auto" />
				</span>
				<span class="ml-2">
					<p-dropdown [options]="motivoOptions" [(ngModel)]="selectedMotivo" placeholder="Filtrar motivo"
						(onChange)="filterMotivo(dt)" optionLabel="label" optionValue="value"
						styleClass="w-full sm:w-auto"></p-dropdown>
				</span>
			</div>
			<p-table #dt [value]="this.clients()" [loading]="loading" scrollDirection="both" [scrollable]="true"
				scrollHeight="400px" styleClass="mt-3" responsiveLayout="scroll" responsiveLayout="scroll" [rows]="5"
				[globalFilterFields]="['name','age','sexo','status']" [paginator]="true"
				[rowsPerPageOptions]="[10,20,30]" [showCurrentPageReport]="true"
				currentPageReportTemplate="Mostrando {first} hasta {last} de {totalRecords} entradas"
				selectionMode="multiple" [rowHover]="true" dataKey="id">
				<ng-template pTemplate="header">

					<tr>
						<th pSortableColumn="name" style="width:200px">Nombre <p-sortIcon field="name"></p-sortIcon>
						</th>
						<th style="width:200px" class="hidden" alignFrozen="left">Id</th>
						<th pSortableColumn="sexo" style="width:200px">Sexo <p-sortIcon field="sexo"></p-sortIcon></th>
						<th pSortableColumn="age" style="width:200px">Edad <p-sortIcon field="age"></p-sortIcon></th>
						<th style="width:200px">Peso</th>
						<th style="width:200px">Estatura</th>
						<!-- <th style="width:200px">IMC</th> -->
						<th style="width:200px">Motivo</th>
						<th style="width:220px" alignFrozen="right">Status</th>
						<th>Options</th>
					</tr>

				</ng-template>
				<ng-template pTemplate="body" let-customer>
					<tr>
						<td style="width:200px" class="font-bold cursor-pointer"><a
								(click)="router.navigate(['/dashboard/detail-client', customer.id ])">
								{{customer.name | titleCase}}</a> </td>
						<td style="width:200px" class="hidden" alignFrozen="left">{{customer.id}}</td>
						<td style="width:200px">{{customer.sexo}}</td>
						<td style="width:200px">{{customer.age}}</td>
						<td style="width:200px">{{customer.peso}}Kg</td>
						<td style="width:200px">{{customer.estatura}}mts</td>
						<!-- <td style="width:200px;"><span class="customer-badge status-proposal">proposal</span></td> -->
						<td style="width:200px">{{customer.status}} </td>
						<td style="width:220px" class="font-bold" alignFrozen="right"><span
								[class]="'customer-badge status-proposal'">{{customer.tipo}}</span></td>
						<td>
							<div class="flex gap-2">
								<button pButton pRipple type="button" (click)="openNew(customer)"
									icon="pi pi-pen-to-square" class="p-button-rounded p-button-success"></button>
								<button pButton pRipple type="button"
									(click)="confirmDeleteClient(customer.id, customer.name)" icon="pi pi-trash"
									class="p-button-rounded p-button-danger"></button>
							</div>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</section>
		}@else {
		<section>
			<div class="">
				<div class="mt-2 ml-4">
					<span class="p-buttonset">
						<button pButton pRipple label="Nuevo" icon="pi pi-plus" class="mr-2"
							(click)="openNew(0)"></button>
					</span>
				</div>
				<div class="mt-5">
					<span class="">
						Debe ingresar un Cliente...
					</span>
				</div>
			</div>
		</section>
		}

	</div>
</div>


<p-toast></p-toast>

<!-- <div class="card">
			<h5>Filter Menu</h5>
			<p-table #dt1 [value]="customers3" dataKey="id" [rows]="10" [loading]="loading" [rowHover]="true" styleClass="p-datatable-gridlines" [paginator]="true" [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll">
				<ng-template pTemplate="caption">
					<div class="flex justify-content-between flex-column sm:flex-row">
						<button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
						<span class="p-input-icon-left mb-2">
							<i class="pi pi-search"></i>
							<input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)" placeholder="Search Keyword" class="w-full"/>
						</span>
					</div>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th style="min-width: 12rem">
							<div class="flex justify-content-between align-items-center">
								Nombre
								<p-columnFilter type="text" field="name" display="menu" placeholder="Search by name"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 12rem">
							<div class="flex justify-content-between align-items-center">
								Sexo
								<p-columnFilter type="text" field="country.name" display="menu" placeholder="Search by country"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 14rem">
							<div class="flex justify-content-between align-items-center">
								Edad
								<p-columnFilter field="representative" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
									<ng-template pTemplate="header">
										<div class="px-3 pt-3 pb-0">
											<span class="font-bold">Agent Picker</span>
										</div>
									</ng-template>
									<ng-template pTemplate="filter" let-value let-filter="filterCallback">
										<p-multiSelect [ngModel]="value" [options]="representatives" placeholder="Any" (onChange)="filter($event.value)" optionLabel="name">
											<ng-template let-option pTemplate="item">
												<div class="p-multiselect-representative-option">
													<img [alt]="option.label" src="assets/demo/images/avatar/{{option.image}}" width="32" style="vertical-align: middle" />
													<span class="ml-2">{{option.name}}</span>
												</div>
											</ng-template>
										</p-multiSelect>
									</ng-template>
								</p-columnFilter>
							</div>
						</th>
						<th style="min-width: 10rem">
							<div class="flex justify-content-between align-items-center">
								Peso
								<p-columnFilter type="date" field="date" display="menu" placeholder="mm/dd/yyyy"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 10rem">
							<div class="flex justify-content-between align-items-center">
								Estatura
								<p-columnFilter type="numeric" field="balance" display="menu" currency="USD"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 12rem">
							<div class="flex justify-content-between align-items-center">
								IMC
								<p-columnFilter field="status" matchMode="equals" display="menu">
									<ng-template pTemplate="filter" let-value let-filter="filterCallback">
										<p-dropdown [ngModel]="value" [options]="statuses" (onChange)="filter($event.value)" placeholder="Any" [style]="{'min-width': '12rem'}" >
											<ng-template let-option pTemplate="item">
												<span [class]="'customer-badge status-' + option.value">{{option.label}}</span>
											</ng-template>
										</p-dropdown>
									</ng-template>
								</p-columnFilter>
							</div>
						</th>
						<th style="min-width: 12rem">
							<div class="flex justify-content-between align-items-center">
								Activity
								<p-columnFilter field="activity" matchMode="between" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
									<ng-template pTemplate="filter" let-filter="filterCallback">
										<p-slider [ngModel]="activityValues" [range]="true" (onSlideEnd)="filter($event.values)" styleClass="m-3" [style]="{'min-width': '12rem'}" ></p-slider>
										<div class="flex align-items-center justify-content-between px-2">
											<span>{{activityValues[0]}}</span>
											<span>{{activityValues[1]}}</span>
										</div>
									</ng-template>
								</p-columnFilter>
							</div>
						</th>
						<th style="min-width: 8rem">
							<div class="flex justify-content-between align-items-center">
								Verified
								<p-columnFilter type="boolean" field="verified" display="menu"></p-columnFilter>
							</div>
						</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-customer>
					<tr>
						<td>
							{{customer.name}}
						</td>
						<td>
							<img src="assets/demo/images/flag/flag_placeholder.png" [class]="'flag flag-' + customer.country.code" width="30">
							<span class="image-text ml-2">{{customer.country.name}}</span>
						</td>
						<td>
							<img [alt]="customer.representative.name" src="assets/demo/images/avatar/{{customer.representative.image}}" width="32" style="vertical-align: middle"/>
							<span class="image-text ml-2">{{customer.representative.name}}</span>
						</td>
						<td>
							{{customer.date | date: 'MM/dd/yyyy'}}
						</td>
						<td>
							{{customer.balance | currency:'USD':'symbol'}}
						</td>
						<td>
							<span [class]="'customer-badge status-' + customer.status">{{customer.status}}</span>
						</td>
						<td>
							<p-progressBar [value]="customer.activity" [showValue]="false" [style]="{'height': '0.5rem'}"></p-progressBar>
						</td>
						<td class="text-center">
							<i class="pi" [ngClass]="{'true-icon pi-check-circle text-green-500': customer.verified, 'false-icon pi-times-circle text-pink-500': !customer.verified}"></i>
						</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="8">No customers found.</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="loadingbody">
					<tr>
						<td colspan="8">Loading customers data. Please wait.</td>
					</tr>
				</ng-template>
    		</p-table>
		</div> -->